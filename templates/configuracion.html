{% extends 'base.html' %}
{% block title %}Configuraci√≥n ‚Äì {{ active|capitalize }}{% endblock %}
{% block content %}
<style>
    .form-text text-muted {
        color: white;
    }
</style>
<div class="config-header">
    <h2>Configuraci√≥n: {{ active|capitalize }}</h2>
    {% if guardado %}
    <div class="alert success">¬°Guardado correctamente!</div>
    {% endif %}
</div>

<!-- Pesta√±as -->
<ul class="tabs">
    {% for tab in tabs %}
    <li class="tab-{{ tab }} {{ 'active' if tab == active else '' }}">
        <a href="{{ url_for('configuracion_tab', tab=tab) }}">{{ tab|capitalize }}</a>
    </li>
    {% endfor %}
</ul>

<!-- Contenido de la subpesta√±a -->
{% if active == 'negocio' %}
<div class="form-group">
    <label>Integraci√≥n con Google Calendar</label>
    <div>
        <a href="{{ url_for('autorizar_google') }}" class="btn btn-primary">
            Autorizar con Google Calendar
        </a>
        <small class="form-text text-muted">
            Permite agendar citas autom√°ticamente en tu calendario
        </small>
    </div>
</div>

<div style="margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px;">
    <h3>üîó WhatsApp Web Integration</h3>
    <p>Conecta con WhatsApp Web para obtener nombres y fotos de perfil actualizados</p>
    <a href="/whatsapp-login" class="btn btn-primary">Conectar WhatsApp Web</a>
    <a href="/whatsapp-status" class="btn btn-secondary">Ver Estado</a>
    <a href="/whatsapp-refresh-contactos" class="btn btn-info">Actualizar Contactos</a>
</div>

<form class="config-form" method="POST" enctype="multipart/form-data">
    <div class="form-card">
        <label>Nombre de tu IA personalizada</label>
        <input type="text" name="ia_nombre" value="{{ datos.ia_nombre or '' }}" required>
    </div>
    <div class="form-card">
        <label>Nombre de tu Negocio</label>
        <input type="text" name="negocio_nombre" value="{{ datos.negocio_nombre or '' }}" required>
    </div>
    <div class="form-card">
        <label>Descripci√≥n del Negocio</label>
        <textarea name="descripcion" rows="4" required>{{ datos.descripcion or '' }}</textarea>
    </div>
    <div class="form-row">
        <div class="form-card">
            <label>URL del Negocio</label>
            <input type="url" name="url" value="{{ datos.url or '' }}">
        </div>
        <div class="form-card">
            <label>Direcci√≥n</label>
            <input type="text" name="direccion" value="{{ datos.direccion or '' }}">
        </div>
    </div>
    {% if datos.app_logo %}
    <input type="hidden" name="app_logo_actual" value="{{ datos.app_logo }}">
    {% endif %}


    <div class="form-row">
        <div class="form-card">
            <label>Nombre de la Aplicaci√≥n</label>
            <input type="text" name="app_nombre" value="{{ datos.app_nombre or 'SmartWhats' }}" required>
            <small class="form-text text-muted">
                Este nombre se mostrar√° en el sidebar y t√≠tulo de la p√°gina
            </small>
        </div>
        <div class="form-card">
            <label>Logo de la Aplicaci√≥n</label>
            <input type="file" name="app_logo" accept="image/png, image/jpeg, image/svg+xml" class="form-control">
            <small class="form-text text-muted">
                Formatos: PNG, JPG, SVG (Tama√±o recomendado: 200x50px)
            </small>
            {% if datos.app_logo %}
            <div style="margin-top: 8px; padding: 5px; background: #f8f9fa; border-radius: 4px; display: inline-block;">
                <img src="{{ datos.app_logo }}" alt="Logo actual" style="max-height: 40px;">
            </div>
            {% endif %}
        </div>
    </div>
    <div class="form-row">
        <div class="form-card">
            <label>Tel√©fono</label>
            <input type="tel" name="telefono" value="{{ datos.telefono or '' }}">
        </div>
        <div class="form-card">
            <label>Correo de contacto</label>
            <input type="email" name="correo" value="{{ datos.correo or '' }}">
        </div>
    </div>
    <div class="form-card">
        <label>¬øQu√© quieres que haga tu IA?</label>
        <textarea name="que_hace" rows="4" required>{{ datos.que_hace or '' }}</textarea>
    </div>
    <button type="submit" class="btn-primary">Guardar Negocio</button>
</form>

{% elif active == 'personalizacion' %}
<form class="config-form" method="POST">
    <div class="form-card">
        <label>Tono de la IA</label>
        <input type="text" name="tono" value="{{ datos.tono or '' }}" required>
    </div>
    <div class="form-card">
        <label>Lenguaje preferido</label>
        <input type="text" name="lenguaje" value="{{ datos.lenguaje or '' }}" required>
    </div>
    <button type="submit" class="btn-primary">Guardar Personalizaci√≥n</button>
</form>

{% elif active == 'precios' %}
<!-- El contenido de precios se maneja en otra ruta -->
<p>La configuraci√≥n de precios se maneja en una p√°gina separada.</p>
<a href="{{ url_for('configuracion_precios') }}" class="btn btn-primary">Gestionar Precios</a>

{% elif active == 'restricciones' %}
<form class="config-form" method="POST">
    <div class="form-card">
        <label>Restricciones del Bot (Una por l√≠nea)</label>
        <textarea name="restricciones" rows="8" placeholder="Ejemplo:
- No agendar citas sin confirmaci√≥n previa
- No proporcionar precios exactos
- No prometer fechas de entrega espec√≠ficas
- No aceptar pedidos fuera del horario laboral
- No compartir informaci√≥n confidencial">{{ datos.restricciones or '' }}</textarea>
        <small class="form-text text-muted">
            Lista de cosas que el bot NO debe hacer. Cada restricci√≥n en una l√≠nea nueva.
        </small>
    </div>

    <div class="form-card">
        <label>Palabras clave prohibidas</label>
        <textarea name="palabras_prohibidas" rows="4" placeholder="Ejemplo:
gratis, inmediato, garantizado, prometo, seguro">{{ datos.palabras_prohibidas or '' }}</textarea>
        <small class="form-text text-muted">
            Palabras que el bot debe evitar usar en sus respuestas.
        </small>
    </div>

    <div class="form-card">
        <label>L√≠mites de la IA</label>
        <div class="form-row">
            <div class="form-group">
                <label>M√°ximo de mensajes por conversaci√≥n:</label>
                <input type="number" name="max_mensajes" value="{{ datos.max_mensajes or '10' }}" min="1" max="1000">
            </div>
            <div class="form-group">
                <label>Tiempo m√°ximo de respuesta (segundos):</label>
                <input type="number" name="tiempo_max_respuesta" value="{{ datos.tiempo_max_respuesta or '30' }}" min="5" max="120">
            </div>
        </div>
    </div>

    <button type="submit" class="btn-primary">Guardar Restricciones</button>
</form>
<form class="config-form" method="POST">
    <!-- ... campos existentes ... -->

    <div class="form-card">
        <label>Nombre de la Empresa (para mostrar en la interfaz)</label>
        <input type="text" name="nombre_empresa" value="{{ datos.nombre_empresa or 'SmartWhats' }}" required>
        <small class="form-text text-muted">
            Este nombre se mostrar√° en el sidebar y t√≠tulo de la p√°gina
        </small>
    </div>

    <div class="form-card">
        <label>URL del Logo</label>
        <input type="url" name="logo_url" value="{{ datos.logo_url or '' }}" placeholder="https://ejemplo.com/logo.png">
        <small class="form-text text-muted">
            URL de la imagen del logo (recomendado: 200x50px, formato PNG o SVG)
        </small>
    </div>

    <div class="form-card">
        <label>Vista previa del logo actual:</label>
        <div style="margin: 10px 0; padding: 10px; background: white; border-radius: 5px; display: inline-block;">
            {% if datos.logo_url %}
            <img src="{{ datos.logo_url }}" alt="Logo actual" style="max-height: 50px; max-width: 200px;">
            {% else %}
            <p>Logo por defecto (SmartWhats)</p>
            {% endif %}
        </div>
    </div>

    <button type="submit" class="btn-primary">Guardar Negocio</button>
</form>
{% endif %}

{% endblock %}