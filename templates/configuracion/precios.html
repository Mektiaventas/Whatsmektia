{% extends 'base.html' %}
{% block title %}Configuraci√≥n ‚Äì Productos y Precios{% endblock %}

{% block content %}
<div class="config-header">
    <h2>Configuraci√≥n: Productos y Precios</h2>
    {% if guardado %}
    <div class="alert success">¬°Guardado correctamente!</div>
    {% endif %}
</div>

<!-- Navegaci√≥n de subpesta√±as -->
<ul class="tabs">
    {% for tab in tabs %}
    <li class="{% if tab == active %}active{% endif %}">
        {% if tab == 'precios' %}
        <a href="{{ url_for('configuracion_precios') }}">{{ tab|capitalize }}</a>
        {% else %}
        <a href="{{ url_for('configuracion_tab', tab=tab) }}">{{ tab|capitalize }}</a>
        {% endif %}
    </li>
    {% endfor %}
</ul>

<!-- NUEVO: Men√∫ de navegaci√≥n persistente -->
<div class="tab-navigation mb-6">
    <div class="tab-buttons">
        <button class="btn btn-primary mt-3" id="btn-user-list" onclick="showSection('user-list')">
            <div class="tab-icon">üë•</div>
            <div>
                <span class="tab-title">Precios vista cliente</span>
            </div>
        </button>

        <button class="btn btn-primary mt-3" id="btn-admin-list" onclick="showSection('admin-list')">
            <div class="tab-icon">üîí</div>
            <div>
                <span class="tab-title">Precios vista Admin</span>
            </div>
        </button>
        <div class="spacer" aria-hidden="true"></div>
        <button class="btn btn-primary mt-3" id="btn-batch-upload" onclick="showSection('batch-upload')">
            <div class="tab-icon">üìä</div>
            <div>
                <span class="tab-title">Carga Template</span>
            </div>
        </button>
        <button class="btn btn-primary mt-3" id="btn-manual-upload" onclick="showSection('manual-upload')">
            <div class="tab-icon">‚úèÔ∏è</div>
            <div>
                <span class="tab-title">Carga manual</span>

            </div>
        </button>

        <button class="btn btn-primary mt-3" id="btn-pdf-upload" onclick="showSection('pdf-upload')">
            <div class="tab-icon">üìÑ</div>
            <div>
                <span class="tab-title">Carga con IA</span>
            </div>
        </button>
    </div>
</div>
<br />
<br />
<!-- Secci√≥n: Carga desde PDF -->
<div class="section" id="pdf-upload" style="display:none;">
    <div class="section-header">
        <h3 class="flex justify-between items-center">
            <span>üìÑ Importar Productos desde PDF/Excel</span>
        </h3>
    </div>

    <div class="card mb-6">
        <div class="card-header bg-success text-white">
            <h3>üìÑ Importar Productos desde PDF/Excel</h3>
        </div>
        <div class="card-body">
            <div class="grid grid-cols-2 gap-6">
                <div>
                    <form action="{{ url_for('subir_pdf_servicios') }}" method="POST" enctype="multipart/form-data">
                        <div class="form-group">
                            <label for="pdf_file" class="block text-sm font-medium mb-2">Subir cat√°logo en PDF/Excel:</label>
                            <input type="file" name="pdf_file" id="pdf_file"
                                   accept=".pdf,.xlsx,.xls,.csv,.docx,.txt" required
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                            <small class="text-muted">Formatos aceptados: PDF, XLSX, XLS, CSV, DOCX, TXT. M√°x. 50MB</small>
                        </div>
                        <button type="submit" class="btn btn-success mt-3">
                            üöÄ Procesar Cat√°logo Autom√°ticamente
                        </button>
                    </form>
                </div>

                <div>
                    <h4 class="font-semibold mb-2">üí° ¬øC√≥mo funciona?</h4>
                    <ul class="text-sm space-y-1">
                        <li>‚Ä¢ Sube tu cat√°logo de productos en PDF/Excel</li>
                        <li>‚Ä¢ La IA analizar√° y extraer√° autom√°ticamente</li>
                        <li>‚Ä¢ Los productos se guardar√°n en la base de datos</li>
                        <li>‚Ä¢ La IA los usar√° para responder consultas</li>
                    </ul>

                    <h4 class="font-semibold mt-3 mb-2">üìã Para mejores resultados:</h4>
                    <ul class="text-sm space-y-1">
                        <li>‚Ä¢ Archivo con SKU, categor√≠as y precios claros</li>
                        <li>‚Ä¢ Estructura clara de productos y categor√≠as</li>
                        <li>‚Ä¢ Precios de mayoreo y menudeo identificados</li>
                        <li>‚Ä¢ Informaci√≥n completa de medidas y modelos</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Secci√≥n: Carga Batch -->
<div class="section" id="batch-upload" style="display:none;">
    <div class="section-header">
        <h3 class="flex justify-between items-center">
            <span>üìä Importar Directamente desde Excel</span>
        </h3>
    </div>

    <div class="card mb-6">
        <div class="card-header bg-primary text-white">
            <h3>üìä Importar Directamente desde Excel</h3>
        </div>
        <div class="card-body">
            <div class="grid grid-cols-2 gap-6">
                <div>
                    <form action="{{ url_for('importar_excel_directo') }}" method="POST" enctype="multipart/form-data">
                        <div class="form-group">
                            <label for="excel_file" class="block text-sm font-medium mb-2">Subir Excel con estructura predefinida:</label>
                            <input type="file" name="excel_file" id="excel_file"
                                   accept=".xlsx,.xls,.csv" required
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                            <small class="text-muted">Las columnas deben coincidir con la base de datos. Formatos: XLSX, XLS, CSV</small>
                        </div>
                        <button type="submit" class="btn btn-primary mt-3">
                            üì• Importar Excel Directamente
                        </button>
                    </form>
                </div>

                <div>
                    <h4 class="font-semibold mb-2">üí° Estructura Requerida</h4>
                    <ul class="text-sm space-y-1">
                        <li>‚Ä¢ sku</li>
                        <li>‚Ä¢ categoria</li>
                        <li>‚Ä¢ subcategoria</li>
                        <li>‚Ä¢ linea</li>
                        <li>‚Ä¢ modelo</li>
                        <li>‚Ä¢ descripcion</li>
                        <li>‚Ä¢ medidas</li>
                        <li>‚Ä¢ costo</li>
                        <li>‚Ä¢ precio_mayoreo</li>
                        <li>‚Ä¢ precio_menudeo</li>
                        <li>‚Ä¢ imagen (opcional)</li>
                        <li>‚Ä¢ etc.</li>
                    </ul>
                    <p class="text-xs mt-3">Los encabezados deben coincidir exactamente con los nombres de columna en la base de datos.</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Secci√≥n: Carga Manual -->
<div class="section" id="manual-upload" style="display:none;">
    <div class="section-header">
        <h3 class="flex justify-between items-center">
            <span>‚úèÔ∏è {{ precio_edit and 'Editar Producto' or 'Agregar Producto Manualmente' }}</span>
        </h3>
    </div>

    <div class="card mb-4">
        <div class="card-body">
            <form action="{{ url_for('configuracion_precio_guardar') }}" method="post" enctype="multipart/form-data">
                {% if precio_edit %}
                <input type="hidden" name="id" value="{{ precio_edit.id }}">
                {% endif %}

                <div class="grid grid-cols-2 gap-4">
                    <div class="form-group">
                        <label for="sku">SKU *</label>
                        <input type="text" id="sku" name="sku" class="input" required
                               value="{{ precio_edit.sku if precio_edit else '' }}"
                               placeholder="Ej: PROD-001">
                    </div>

                    <div class="form-group">
                        <label for="servicio">Producto *</label>
                        <input type="text" id="servicio" name="servicio" class="input" required
                               value="{{ precio_edit.servicio if precio_edit else '' }}"
                               placeholder="Ej: Laptop Gaming">
                    </div>
                </div>

                <div class="grid grid-cols-3 gap-4">
                    <div class="form-group">
                        <label for="categoria">Categor√≠a</label>
                        <input type="text" id="categoria" name="categoria" class="input"
                               value="{{ precio_edit.categoria if precio_edit else '' }}"
                               placeholder="Ej: Electr√≥nicos">
                    </div>

                    <div class="form-group">
                        <label for="subcategoria">Subcategor√≠a</label>
                        <input type="text" id="subcategoria" name="subcategoria" class="input"
                               value="{{ precio_edit.subcategoria if precio_edit else '' }}"
                               placeholder="Ej: Computadoras">
                    </div>

                    <div class="form-group">
                        <label for="linea">L√≠nea</label>
                        <input type="text" id="linea" name="linea" class="input"
                               value="{{ precio_edit.linea if precio_edit else '' }}"
                               placeholder="Ej: Gaming">
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div class="form-group">
                        <label for="modelo">Modelo</label>
                        <input type="text" id="modelo" name="modelo" class="input"
                               value="{{ precio_edit.modelo if precio_edit else '' }}"
                               placeholder="Ej: XPS-15">
                    </div>

                    <div class="form-group">
                        <label for="medidas">Medidas</label>
                        <input type="text" id="medidas" name="medidas" class="input"
                               value="{{ precio_edit.medidas if precio_edit else '' }}"
                               placeholder="Ej: 15.6 pulgadas">
                    </div>
                </div>

                <div class="form-group">
                    <label for="descripcion">Descripci√≥n</label>
                    <textarea id="descripcion" name="descripcion" class="textarea" rows="2"
                              placeholder="Ej: Laptop para gaming con RTX 4060, 16GB RAM, 1TB SSD">{{ precio_edit.descripcion if precio_edit else '' }}</textarea>
                </div>

                <div class="grid grid-cols-3 gap-4">
                    <div class="form-group">
                        <label for="costo">Costo *</label>
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-600">$</span>
                            <input type="number" step="0.01" min="0" id="costo" name="costo" class="input pl-8" required
                                   value="{{ precio_edit.costo if precio_edit else '' }}"
                                   placeholder="0.00">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="precio_mayoreo">Precio Mayoreo</label>
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-600">$</span>
                            <input type="number" step="0.01" min="0" id="precio_mayoreo" name="precio_mayoreo" class="input pl-8"
                                   value="{{ precio_edit.precio_mayoreo if precio_edit else '' }}"
                                   placeholder="0.00">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="precio_menudeo">Precio Menudeo</label>
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-600">$</span>
                            <input type="number" step="0.01" min="0" id="precio_menudeo" name="precio_menudeo" class="input pl-8"
                                   value="{{ precio_edit.precio_menudeo if precio_edit else '' }}"
                                   placeholder="0.00">
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">


                    <div class="form-group">
                        <label for="imagen">Imagen</label>
                        <div class="mb-2">
                            <select id="imagen-tipo" class="select mb-2" onchange="toggleImagenInput()">
                                <option value="archivo">Subir archivo</option>
                                <option value="url">Usar URL de internet</option>
                            </select>
                        </div>

                        <div id="imagen-archivo-container">
                            <input type="file" id="imagen" name="imagen" class="input"
                                   accept="image/*">
                            <small class="text-muted block mt-1">Sube una imagen desde tu dispositivo</small>
                        </div>

                        <div id="imagen-url-container" class="hidden">
                            <input type="text" id="imagen_url" name="imagen_url" class="input"
                                   placeholder="https://ejemplo.com/imagen.jpg">
                            <small class="text-muted block mt-1">Ingresa la URL completa de una imagen en internet</small>
                        </div>

                        {% if precio_edit and precio_edit.imagen %}
                        <div class="mt-2">
                            <small class="text-muted">Imagen actual: {{ precio_edit.imagen }}</small>
                            {% if precio_edit.imagen and precio_edit.imagen.startswith('http') %}
                            <img src="{{ precio_edit.imagen }}" class="mt-1 h-16 w-auto object-contain border rounded" alt="Vista previa">
                            {% elif precio_edit.imagen %}
                            <img src="/uploads/{{ precio_edit.imagen }}" class="mt-1 h-16 w-auto object-contain border rounded" alt="Vista previa">
                            {% endif %}
                        </div>
                        {% endif %}
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div class="form-group">
                        <label for="status_ws">Status WS</label>
                        <input type="text" id="status_ws" name="status_ws" class="input"
                               value="{{ precio_edit.status_ws if precio_edit else '' }}"
                               placeholder="Ej: activo">
                    </div>
                    <div class="form-group">
                        <label for="catalogo">Cat√°logo</label>
                        <input type="text" id="catalogo" name="catalogo" class="input"
                               value="{{ precio_edit.catalogo if precio_edit else '' }}"
                               placeholder="Ej: Cat√°logo 1">
                    </div>
                </div>
                <div class="grid grid-cols-3 gap-4">
                    <div class="form-group">
                        <label for="catalogo2">Cat√°logo 2</label>
                        <input type="text" id="catalogo2" name="catalogo2" class="input"
                               value="{{ precio_edit.catalogo2 if precio_edit else '' }}"
                               placeholder="Ej: Cat√°logo 2">
                    </div>
                    <div class="form-group">
                        <label for="catalogo3">Cat√°logo 3</label>
                        <input type="text" id="catalogo3" name="catalogo3" class="input"
                               value="{{ precio_edit.catalogo3 if precio_edit else '' }}"
                               placeholder="Ej: Cat√°logo 3">
                    </div>
                    <div class="form-group">
                        <label for="proveedor">Proveedor</label>
                        <input type="text" id="proveedor" name="proveedor" class="input"
                               value="{{ precio_edit.proveedor if precio_edit else '' }}"
                               placeholder="Ej: Proveedor S.A.">
                    </div>
                </div>
                <div class="form-actions flex justify-end gap-2">
                    <button type="submit" class="btn primary">
                        {{ precio_edit and 'üíæ Actualizar' or 'üíæ Guardar' }}
                    </button>
                    <a href="{{ url_for('configuracion_precios') }}" class="btn secondary">
                        ‚Ü©Ô∏è Cancelar
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Secci√≥n: Lista Usuario -->
<div class="section" id="user-list" style="display:none;">
    <div class="card mb-4">
        <div class="card-header bg-gray-100">
            <h3>üìã Productos (Vista Cliente) ({{ precios|length }} registros)</h3>
        </div>
        <div class="card-body">
            {% if precios %}
            <div class="table-responsive">
                <div class="table-scroll table-scroll-client">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>SKU</th>
                                <th>Categor√≠a</th>
                                <th>Subcategor√≠a</th>
                                <th>L√≠nea</th>
                                <th>Modelo</th>
                                <th>Descripci√≥n</th>
                                <th>Medidas</th>
                                <th>Imagen</th>
                                <th>Menudeo</th>
                                <th>Mayoreo</th>
                                <th>Status</th>
                                <th>Cat√°logo</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for precio in precios %}
                            <tr>
                                <td>{{ precio.sku or '-' }}</td>
                                <td>{{ precio.categoria or '-' }}</td>
                                <td>{{ precio.subcategoria or '-' }}</td>
                                <td>{{ precio.linea or '-' }}</td>
                                <td>{{ precio.modelo or '-' }}</td>
                                <td class="desc-cell" data-desc="{{ precio.descripcion|default('')|e }}">
                                    {{ precio.descripcion|default('-')|truncate(300) }}
                                </td>
                                <td>{{ precio.medidas or '-' }}</td>
                                <td>
                                    {% if precio.imagen %}
                                    {% if precio.imagen.startswith('http') %}
                                    <img class="imagen_tabla" src="/uploads/productos/{{ precio.imagen }}" ...>
                                    {% else %}
                                    <img class="imagen_tabla" src="/uploads/productos/{{ precio.imagen }}" ...>
                                    {% endif %}
                                    {% else %}
                                    -
                                    {% endif %}
                                </td>
                                <td class="text-right text-blue-600">${{ "{:,.2f}".format(precio.precio_menudeo) if precio.precio_menudeo else '-' }}</td>
                                <td class="text-right text-green-600">${{ "{:,.2f}".format(precio.precio_mayoreo) if precio.precio_mayoreo else '-' }}</td>
                                <td>{{ precio.status_ws or '-' }}</td>
                                <td>{{ precio.catalogo or '-' }}</td>
                                <td>
                                    <a href="{{ url_for('configuracion_precio_editar', pid=precio.id) }}"
                                       class="btn small primary">Editar</a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            {% else %}
            <div class="text-center py-8">
                <div class="text-gray-500 text-lg mb-2">üìù No hay productos registrados</div>
                <p class="text-sm text-gray-400">Usa el formulario de arriba para agregar productos manualmente.</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Secci√≥n: Lista Admin -->
<div class="section" id="admin-list" style="display:none;">
    <div class="card">
        <div class="card-header bg-blue-100">
            <h3>üîí Productos y Precios (Vista Completa Admin) ({{ precios|length}} registros)</h3>
        </div>
        <div class="card-body">
            {% if precios %}
            <div class="table-responsive">
                <div class="table-scroll table-scroll-admin">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>SKU</th>
                                <th>Categor√≠a</th>
                                <th>Subcategor√≠a</th>
                                <th>L√≠nea</th>
                                <th>Modelo</th>
                                <th>Descripci√≥n</th>
                                <th>Medidas</th>
                                <th>Costo</th>
                                <th>Menudeo</th>
                                <th>Mayoreo</th>
                                <th>Imagen</th>
                                <th>Status</th>
                                <th>Cat√°logo</th>
                                <th>Cat√°logo 2</th>
                                <th>Cat√°logo 3</th>
                                <th>Proveedor</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody class="cuerpo_tabla">
                            {% for precio in precios %}
                            <tr>
                                <td>{{ precio.sku or '-' }}</td>
                                <td>{{ precio.categoria or '-' }}</td>
                                <td>{{ precio.subcategoria or '-' }}</td>
                                <td>{{ precio.linea or '-' }}</td>
                                <td>{{ precio.modelo or '-' }}</td>
                                <td class="desc-cell" data-desc="{{ precio.descripcion|default('')|e }}">
                                    {{ precio.descripcion|default('-')|truncate(300) }}
                                </td>
                                <td>{{ precio.medidas or '-' }}</td>
                                <td class="text-right text-red-600">${{ "{:,.2f}".format(precio.costo) if precio.costo else '-' }}</td>
                                <td class="text-right text-blue-600">${{ "{:,.2f}".format(precio.precio_menudeo) if precio.precio_menudeo else '-' }}</td>
                                <td class="text-right text-green-600">${{ "{:,.2f}".format(precio.precio_mayoreo) if precio.precio_mayoreo else '-' }}</td>
                                <td>
                                    {% if precio.imagen %}
                                    {% if precio.imagen.startswith('http') %}
                                    <img class="imagen_tabla" src="/uploads/productos/{{ precio.imagen }}" ...>
                                    {% else %}
                                    <img class="imagen_tabla" src="/uploads/productos/{{ precio.imagen }}" ...>
                                    {% endif %}
                                    {% else %}
                                    -
                                    {% endif %}
                                </td>
                                <td>{{ precio.status_ws or '-' }}</td>
                                <td>{{ precio.catalogo or '-' }}</td>
                                <td>{{ precio.catalogo2 or '-' }}</td>
                                <td>{{ precio.catalogo3 or '-' }}</td>
                                <td>{{ precio.proveedor or '-' }}</td>
                                <td>
                                    <div class="flex space-x-2">
                                        <a href="{{ url_for('configuracion_precio_editar', pid=precio.id) }}"
                                           class="btn small primary">Editar</a>
                                        <form action="{{ url_for('configuracion_precio_borrar', pid=precio.id) }}"
                                              method="post" class="inline-form">
                                            <button type="submit"
                                                    class="btn small danger"
                                                    onclick="return confirm('¬øEliminar {{ precio.descripcion[:30] if precio.descripcion else precio.sku }}?');">
                                                Borrar
                                            </button>
                                        </form>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            {% else %}
            <div class="text-center py-8">
                <div class="text-gray-500 text-lg mb-2">üìù No hay productos registrados</div>
                <p class="text-sm text-gray-400">Usa el formulario de arriba para agregar productos manualmente.</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Mensajes Flash -->
<div class="mt-4">
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    {% for category, message in messages %}
    <div class="alert {{ 'success' if category == 'success' else 'error' if category == 'error' else 'warning' }}">
        {{ message }}
    </div>
    {% endfor %}
    {% endif %}
    {% endwith %}
</div>

<style>
    .espacio{
        width:5%;
    }
    .imagen_tabla {
        width: 50px;
        height: 50px;
        object-fit: cover;
    }

    .alert {
        padding: 12px 16px;
        border-radius: 6px;
        margin: 10px 0;
        font-weight: 500;
    }

        .alert.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

    /* Dashboard menu styles */
    .dashboard-menu {
        margin: 20px 0;
    }

    .dashboard-item {
        background: white;
        border: 1px solid #e2e8f0;
        border-radius: 8px;
        padding: 20px;
        text-align: center;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        transition: all 0.3s ease;
        cursor: pointer;
    }
    /* Add near other CSS rules in the same <style> block */
    .spacer {
        display: inline-block;
        width: 30px; /* espacio horizontal de 30px */
        height: 1px; /* ocupa poco alto, puede dejarse 1px */
        vertical-align: middle;
    }

    /* responsive: reducir el espacio en pantallas peque√±as */
    @media (max-width: 600px) {
        .spacer {
            width: 12px;
        }
    }

    .btn-primario {
        align-self: flex-start;
        padding: 12px 24px;
        background: linear-gradient(135deg, green, blue);
        color: #fff;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        box-shadow: 0 3px 8px rgba(0,0,0,0.15);
        transition: background .2s, transform .1s;
    }

        .btn-primario:hover {
            background: linear-gradient(135deg, blue, green);
            transform: translateY(-2px);
        }

    .dashboard-item:hover {
        transform: translateY(-5px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        border-color: #3182ce;
    }

    .dashboard-icon {
        font-size: 2.5rem;
        margin-bottom: 10px;
    }

    .dashboard-item h3 {
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 5px;
        color: #2d3748;
    }

    .dashboard-item p {
        font-size: 0.9rem;
        color: #718096;
    }

    /* Section styles */
    .section {
        margin-bottom: 30px;
    }

    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        padding: 10px;
        background: #f8fafc;
        border-radius: 6px;
    }

    /* Existing button styles */
    .btn-success {
        background: #28a745;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
    }

        .btn-success:hover {
            background: #218838;
        }

    .bg-success {
        background: #28a745 !important;
    }

    .bg-blue-50 {
        background: #eff6ff;
    }

    .text-green-600 {
        color: #059669;
    }

    .text-blue-600 {
        color: #2563eb;
    }

    .cursor-pointer {
        cursor: pointer;
    }

    .hidden {
        display: none !important;
    }

    .card-header {
        transition: background-color 0.2s;
    }

        .card-header:hover {
            background-color: white;
            color: black;
        }

    /* Keep container responsive */
    .table-responsive {
        width: 100%;
        overflow: hidden; /* hide outer overflow, inner .table-scroll handles scrolling */
    }

    /* Table layout: allow shrinking and wrapping */
    .table {
        width: 100%;
        border-collapse: collapse;
        table-layout: fixed; /* columns share available width */
        font-size: 13px;
    }
    .table td {
        border: 1px solid black;
        height: 8%;
    }
        .table th,
        .table td {
            padding: 6px 8px;
            text-align: left;
            white-space: normal; /* allow wrapping */
            overflow-wrap: anywhere; /* break long words/numbers */
            word-break: break-word;
        }

        .table th {
            background-color: white;
            color: black;
        }

    /* Scroll container for big tables: keeps page shorter while table scrolls internally.
       position: relative is required so position: sticky on thead th works inside this box. */
    .table-scroll {
        position: relative;
        max-height: 500px; /* default */
        overflow-y: auto; /* vertical scroll for rows */
        overflow-x: auto; /* allow horizontal scroll if needed */
        -webkit-overflow-scrolling: touch;
        border-radius: 6px;
        padding-right: 6px; /* avoid cutting last column behind scrollbar */
        background: transparent;
    }

    /* Slightly different heights for client vs admin views */
    .table-scroll-client {
        max-height: 600px;
    }

    .table-scroll-admin {
        max-height: 600px;
    }

    /* Sticky header: keep thead visible while body scrolls */
    .table thead th {
        position: sticky;
        top: 0;
        z-index: 5; /* above table rows */
        background: linear-gradient(#ffffff, #f8fafc); /* matches header background */
        box-shadow: 0 2px 4px rgba(0,0,0,0.04);
    }

    /* Optional: give the header cells a bit more weight */
    .table thead th {
        font-weight: 600;
    }

    /* Optional scrollbar styling */
    .table-scroll::-webkit-scrollbar {
        width: 10px;
        height: 10px;
    }

    .table-scroll::-webkit-scrollbar-track {
        background: white;
    }

    .table-scroll::-webkit-scrollbar-thumb {
        background: yellow;
        border-radius: 8px;
    }
    .desc-cell {
        font-size: xx-small;
    }
    /* prioritize wrapping for long columns (Descripci√≥n, Categor√≠a, etc.) */
    .table th:nth-child(6), .table td:nth-child(6) {
        max-width: 180px;
    }
    /* Descripci√≥n */
    .table th:nth-child(2), .table td:nth-child(2),
    .table th:nth-child(3), .table td:nth-child(3),
    .table th:nth-child(4), .table td:nth-child(4) {
        max-width: 120px;
    }
    /* Tooltip styles (floating element appended to body) */
    .floating-tooltip {
        position: fixed;
        max-width: 640px;
        width: auto;
        background: #ffffff;
        color: #111827;
        border: 1px solid rgba(0,0,0,0.08);
        box-shadow: 0 6px 18px rgba(0,0,0,0.12);
        padding: 10px 12px;
        border-radius: 8px;
        font-size: 13px;
        line-height: 1.3;
        z-index: 9999;
        white-space: pre-wrap; /* respect newlines */
        word-break: break-word;
    }

        /* slight indicator triangle */
        .floating-tooltip::after {
            content: "";
            position: absolute;
            width: 10px;
            height: 10px;
            background: #ffffff;
            transform: rotate(45deg);
            border-left: 1px solid rgba(0,0,0,0.08);
            border-top: 1px solid rgba(0,0,0,0.08);
            left: 12px;
            top: -6px;
        }
    /* responsive tweaks */
    @media (max-width: 1200px) {
        .table th, .table td {
            padding: 5px 6px;
            font-size: 12px;
        }

        .imagen_tabla {
            width: 28px;
            height: 28px;
        }
        .floating-tooltip {
            max-width: 360px;
            font-size: 12px;
        }
    }
    

    
</style>
<script>
    // Function to show a specific section and highlight its button
    function showSection(sectionId) {
        // Hide all sections
        const sections = document.querySelectorAll('.section');
        sections.forEach(section => {
            section.style.display = 'none';
        });

        // Remove active class from all buttons
        const buttons = document.querySelectorAll('.btn, .btn-primario, .btn-primary');
        buttons.forEach(button => {
            button.classList.remove('active');
        });

        // Show the requested section
        const targetSection = document.getElementById(sectionId);
        if (targetSection) {
            targetSection.style.display = 'block';
            // Scroll to the section (but not to the very top)
            window.scrollTo({
                top: document.querySelector('.tab-navigation').offsetTop + 60,
                behavior: 'smooth'
            });
        }

        // Highlight the active button
        const activeButton = document.getElementById(`btn-${sectionId}`);
        if (activeButton) {
            activeButton.classList.add('active');
        }
    }

    // Image input toggle function
    function toggleImagenInput() {
        const tipo = document.getElementById('imagen-tipo').value;
        const archivoContainer = document.getElementById('imagen-archivo-container');
        const urlContainer = document.getElementById('imagen-url-container');

        if (tipo === 'archivo') {
            archivoContainer.style.display = 'block';
            urlContainer.style.display = 'none';
            document.getElementById('imagen_url').value = '';
        } else {
            archivoContainer.style.display = 'none';
            urlContainer.style.display = 'block';
            document.getElementById('imagen').value = '';
        }
    }

    // On document ready
    document.addEventListener('DOMContentLoaded', function () {
        console.log("DOM loaded - initializing tab navigation");

        // Default to the user-list (client prices) section
        let initialSection = 'user-list';

        {% if precio_edit %}
        // If editing a product, go directly to manual upload
        initialSection = 'manual-upload';
        {% endif %}

        // Check for URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const section = urlParams.get('section');
        if (section) {
            initialSection = section;
        }

        // Show the initial section
        showSection(initialSection);

        // Make sure the imagen-url-container is hidden initially
        const urlContainer = document.getElementById('imagen-url-container');
        if (urlContainer) {
            urlContainer.style.display = 'none';
        }
    });
</script>
{% endblock %}